

1. 如何手写一个简单的静态资源服务器用以部署前端
2. 为何需要 Nginx、docker 等工具部署前端部署


## http 报文

最简部署：向服务器发送一个获取 HTML 资源的请求，服务端响应一段 HTML 资源。
请求资源的过程中将发送一段请求报文（Request Message），服务端返回的 HTML 资源作为响应报文（Response Message）

因此，写一段服务器代码，在 HTTP 响应报文中设置响应体为 HTML，便完成了对极简前端的部署。

部署的简单理解：
假设有一台拥有公共 IP 地址的服务器，在这台服务器使用 nodejs 运行 server.js 的代码，则外网的人就可以通过 IP:3213 访问该页面。
那么这就可以理解为部署，即使所有人都可以访问。


## 关于部署的疑问

### 问：既然可以通过 nodejs 直接运行代码启动服务并且暴露端口对外提供服务，那么为什么还需要 Nginx呢？

**需要管理诸多服务（比如A网站、B网站），通过 Nginx 进行路由转发至不同的服务，这就是反向代理**，另外 TLS、GZIP、HTTP2等诸多功能，也需要使用 Nginx 进行配置。

### 问：我确实不介意别人通过 IP:Port 的方式来访问我的应用，那在服务器可以 npm run dev 部署吗？

可以，但是非常不推荐。`npm run dev` 往往需要监听文件变更并重启服务，此处需要消耗较大的内存以及 CPU 时间，导致性能问题。

### 问：那为什么需要 Docker 部署？

用以隔离环境。

假设有三个后端服务，分别用 Java、Go、Node 编写，需要在服务器分别安装三者的环境，才能运行所有语言编写的代码，这对于开发者来说非常麻烦。

假设你有三个 Node 服务，分别用 node10、node12、node14 编写，你需要在服务器分别安装三个版本 nodejs 才能运行各个版本 nodejs 编写的代码，对于开发者而言也非常麻烦。

而有了 Docker，就没有这种问题，它可单独提供某种语言的运行环境，并同时与宿主机隔离起来。

对于前端而言，此时你可以通过由自己在项目中单独维护 nginx.conf 进行一些 nginx 的配置，大大提升前端的自由性和灵活度，而无需通过运维或者后端来进行。

### 作业

#### 1. 为什么基于 stream 的静态服务器拥有更高的性能

stream 允许一段一段地接受和处理数据，相比较于获取整个数据再处理，stream 不仅不需要占用一大块内存空间来存放整个数据，节省内存占用空间，而且还能实时地对数据进行处理，不需要等待整个数据获取完毕，从而缩短整个操作；的耗时

#### 2. 为什么基于 stream 后，serve 等静态资源服务器仍然会计算 Content-Length

Content-Length 是 HTTP 消息长度，用十进制数字表示的八位字节的数目，是 Header 中常见的字段， 如果错误就会导致异常
Content-Length 指的是报文中主体的字节大小，是包含了所有的内容编码的。比如对文本进行压缩后，指的就是压缩后的打下
为了能够知晓数据再传输过程中是否丢失？

#### 3. 继续完善静态服务器，使其基于 stream，并能给出正确的 Content-Length。


#### 4. 继续完善静态服务器，使其作为一个命令行工具，支持指定端口号、读取目录、404、stream (甚至 trailingSlash、cleanUrls、rewrite、redirect 等)。可参考 serve-handler。


#### 5. 什么是 rewrite 和 redirect

redirect：重定向
rewrite：重写，不仅可以实现redirect 在 URL 规则上的重定向，还可以直接重写请求到实际的文件以及更多的附加功能。

关于重定向：
1. 通过重定向，浏览器知道页面位置发生变化，从而改变地址栏显示的地址。
2. 通过重定向，搜索引擎意识到页面被移动了，从而更新搜索引擎索引，将原来失效的链接从搜索结果中移除
3. 临时重定向(R=302)和永久重定向(R=301)都是亲搜索引擎的，是SEO的重要技术。
4. redirect是浏览器和服务器发生两次请求，也就是服务器命令客户端“去访问某个页面”；
5. redirect的URL需要传送到客户端
6. redirect是从一个地址跳转到另一个地址。

关于重写：
1. rewrite 的URL 只是在服务器端
2. rewrite 则是服务器内部的一个接管，在服务器内部告诉“某个页面请帮我处理这个用户的请求”，浏览器和服务器发生一次交互，浏览器不知道该页面做的响应，浏览器只是向服务器发出一个请求
3. URL 重写用于将页面映射到本站另一个页面，若重写到另一个网络主机，则按照重定向处理

就像用户去买手机，缺货时的两种处理：让用户自己去其他地方买（redirect）；公司从其他的地方调货（rewrite）。

**名词解释**
1. 服务器：一台拥有公共 IP 且永不关机的电脑
2. 客户端：一般指自己的电脑，前端里面一般情况下指浏览器
3. 公共 IP：指可以在互联网中发现对方的 IP

